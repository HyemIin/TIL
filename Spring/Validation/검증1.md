# (목적) Validation?? 하고 싶은게 뭐야?
- 사용자가 입력 필드에 "올바른 양식"으로 값을 입력하지 않는다면, 상품등록을 차단하고, 사용자에게 다시 올바르게 입력하라고 알려주고 싶어. <br> 
여기서 말하는 올바른 양식이란, 타입을 맞췄는지, 비즈니스 요구사항에 따른 제한사항(최소 금액, 최소 수량 등)을 준수했는지를 의미한다.
- 현재는 사용자가 잘못 입력해도, 필수 필드를 다 채우지 않고 입력해도 등록이 되는구조기 때문이다.

# (목표)
- 올바르지 않은 양식 입력 시, 상품 등록을 차단한다.
- 사용자가 잘못 입력한 양식은 빨간색으로 잘못 입력했음+가이드를 제시한다.
- 사용자가 잘못 입력한 후 상품 등록을 누를 시, 에러 페이지를 띄우지 않는다.
- 사용자가 잘못 입력한 내용을 지우지 않고, 그대로 유지시킨다.(사용자가 무엇을 잘못 입력했는지 확인해야하기 때문)

# 1. Bean Validation

- (배경) 지금까지는 검증 기능에 대한 코드를 if문을 통해 하나씩 다 작성했었다.
- (배경) 그러나검증 기능을 지금처럼 매번 코드로 작성하는 것은 상당히 번거롭다. 특히 특정 필드에 대한 검증 로직은 대부분 빈 값인지 아닌지, 특정 크기를 넘는지 아닌지와 같이 매우 일반적인 로직이다.
- (정의) 이런 검증 로직을 모든 프로젝트에 적용할 수 있게 공통화하고, 표준화 한 것이 바로 Bean Validation
이다.
- (방법)
    - build.gradle 에 아래 의존성 추가
      `implementation 'org.springframework.boot:spring-boot-starter-validation'`
    - 사용할 클래스에 어노테이션 추가
        - @NotBlank : 빈값 + 공백만 있는 경우를 허용하지 않는다.
        @NotNull : null 을 허용하지 않는다.
        @Range(min = 1000, max = 1000000) : 범위 안의 값이어야 한다.
        @Max(9999) : 최대 9999까지만 허용한다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a0db21b8-0779-4fb1-b6f8-05d2c521ea22/Untitled.png)

## 1) 그러면 위 사진의 검증 어노테이션은 스프링이 오또케 인식함??

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/46eefee3-d5b7-4875-886d-29f1a9ce9d41/Untitled.png)

- 아까 의존성 주입 + 위 그림에 답이 있다.
- Controller에서 @validated(또는 @valid)를 붙여주면, LocalValidatorFactoryBean을 글로벌 Validator로 등록한다.
그렇게 되면 @NotNull과 같은 검증 어노테이션을 보고 인식할 수 있다.

# 2.위에 사용한 Validation 에러코드에 대해 좀 더 자세히 알아보자.

- (배경) 스프링이 검증 어노테이션 제공해서 정말 편해지는거? OK.근데 좀 더 자세히 고객에서 오류 메세지를 세분화 시켜서 전달하고 싶음 어케해??
- 아래 리스트를 보면, MessageCodesResolver가 다양한 메세지 코드를 순서대로 제공한다.

**@NotBlank**

NotBlank.item.itemName
NotBlank.itemName
NotBlank.java.lang.String
NotBlank

**@Range**

Range.item.price
Range.price
Range.java.lang.Integer
Range

- **(방법) 위 레벨에 맞게 errors.properies에 등록만 하면 됨.**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/03ad46f7-e4a8-4596-a7f7-4082db7b091c/Untitled.png)

## 1) 오브젝트에러 처리 방법 (지엽적)

- (배경) 특정 필드가 아닌 해당 오브젝트 관련 오류가 발생한다면 어떻게 처리할 수 있을지??
원래는 아래와 같이 처리했다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/093ea676-de6e-46b7-9e25-05abbcc03d4e/Untitled.png)

- 이렇게 쓰는 것 보단, 요딴게 있긴 합니다.

  `@ScriptAssert(lang = "javascript", script = "_this.price * _this.quantity >=
  10000")`

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ff94445d-25d8-41e5-8077-71b055399d9e/Untitled.png)

- 이렇게 아이템 클래스에 넣어주면 됨. 근데 왜 주석처리를 했냐??
- 안쓴데,,,실제 사용해보면 제약이 많고 복잡하고,, 그리고 실무에서는 검증 기능이 해당 객체의 범위를 넘어서는 경우들도 종종 등장하는데, 그런 경우 대응이 어렵다.
- ***영한님 왈. “따라서 오브젝트 오류(글로벌 오류)의 경우 @ScriptAssert 을 억지로 사용하는 것 보다는 다음과 같이 오브젝트 오류 관련 부분만 직접 자바 코드로 작성하는 것을 권장한다.”***

- 결론 : 원래대로 쓰자.
